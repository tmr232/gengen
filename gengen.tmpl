{{define "package"}}
    //go:build !gengen

    // AUTOGENERATED DO NOT MODIFY

    package {{.PackageName}}

    {{.Imports}}

    {{join .Functions "\n"}}

{{end}}


{{define "function"}}
    func {{.Name}}{{trimPrefix .Signature "func"}} {
        {{range $name, $type := .State}}
            var {{$name}} {{$type}}
        {{end}}
        {{range .ExtraState}}
            {{.}}
        {{end}}
        __next := 0
        return &gengen.GeneratorFunction[{{.ReturnType}}]{
            Advance: func() (__hasValue bool, __value {{.ReturnType}}, __err error) {
                switch __next {
                {{range .StateIndices}}
                case {{.}}:
                    goto {{template "next" .}}
                {{end}}
                }
                {{template "next" 0}}:

                {{.Body}}
            },
        }
    }
{{end}}

{{define "return"}}
    __err = {{.ReturnValue}}
    return
{{end}}

{{define "yield"}}
    __hasValue = true
    __value = {{.YieldValue}}
    __next = {{.Next}}
    return

{{template "next" .Next}}:
{{end}}

{{define "if"}}
    {{.Init}}
    if {{.Cond}} {
    goto __Then{{.If}}
    } else {
    goto __Else{{.If}}
    }
    __Then{{.If}}:
    {{.Body}}
    goto __After{{.If}}
    __Else{{.If}}:
    {{.Else}}
    goto __After{{.If}}
    __After{{.If}}:
{{end}}

{{define "forever"}}
__Head{{.Loop.Id}}:
{{if .Loop.HasContinue}}
    __Continue{{.Loop.Id}}:
{{end}}
    {{.Body}}
    goto __Head{{.Loop.Id}}
{{if .Loop.HasBreak}}
__After{{.Loop.Id}}:
{{end}}
{{end}}

{{define "for"}}
    {{.Init}}
__Head{{.Loop.Id}}:
    if {{.Cond}} {
        goto __Body{{.Loop.Id}}
    } else {
        goto __After{{.Loop.Id}}
    }
__Body{{.Loop.Id}}:
    {{.Body}}
    {{if .Loop.HasContinue}}
__Continue{{.Loop.Id}}:
    {{end}}
    {{.Post}}
    goto __Head{{.Loop.Id}}
__After{{.Loop.Id}}:
{{end}}



{{define "for-range-map"}}
    {{.Adapter}} = gengen.NewMapAdapter[{{.KeyType}}, {{.ValueType}}]({{.Map}})

__Head{{.Loop.Id}}:
    {{if .Loop.HasContinue}}
__Continue{{.Loop.Id}}:
    {{end}}
    if {{.Adapter}}.Next() {
        goto __Body{{.Loop.Id}}
    } else {
        goto __After{{.Loop.Id}}
    }
__Body{{.Loop.Id}}:
    {{.Key}}, {{.Value}} = {{.Adapter}}.Value()
    {{.Body}}
    goto __Head{{.Loop.Id}}
__After{{.Loop.Id}}:
{{end}}

{{define "for-range-slice"}}
    {{.Adapter}} = gengen.NewSliceAdapter[{{.ValueType}}]({{.Slice}})

__Head{{.Loop.Id}}:
    {{if .Loop.HasContinue}}
__Continue{{.Loop.Id}}:
    {{end}}
    if {{.Adapter}}.Next() {
    goto __Body{{.Loop.Id}}
    } else {
    goto __After{{.Loop.Id}}
    }
    __Body{{.Loop.Id}}:
    {{.Key}}, {{.Value}} = {{.Adapter}}.Value()
    {{.Body}}
    goto __Head{{.Loop.Id}}
    __After{{.Loop.Id}}:
{{end}}

{{define "next"}}
__Next{{.}}
{{- end}}
